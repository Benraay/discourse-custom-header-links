<script type="text/discourse-plugin" version="0.8.20">
let customHeaderLinks = settings.Custom_header_links;
const { iconNode } = require("discourse-common/lib/icon-library");

customHeaderLinks.split("|").map(i => {
  let seg = $.map(i.split(","), $.trim),
    linkIcon = seg[0],
    linkText = seg[1],
    linkTitle = seg[2],
    linkHref = seg[3],
    deviceClass = "." + seg[4],
    linkTarget = seg[5] === "self" ? "" : "_blank",
    keepOnScrollClass = seg[6] === "keep" ? ".keep" : "";

  api.decorateWidget("header-buttons:before", helper => {
    let contentHelper=[];
    //put icon if there is one
    if(linkIcon != null && linkIcon.length>2){
      contentHelper.push(iconNode(linkIcon));
    }
    contentHelper.push(helper.h("span",linkText));

    return helper.h(
      "li.headerLink" + deviceClass + keepOnScrollClass,
      helper.h(
        "a",
        {
          href: linkHref,
          title: linkTitle,
          target: linkTarget
        },[
            iconNode(linkIcon),
            helper.h("span",linkText)
          ]
      )
    );
  });
});

api.decorateWidget("home-logo:after", helper => {
  let titleVisible = helper.attrs.minimized;
  if (titleVisible) {
    $(".d-header").addClass("hide-menus");
  } else {
    $(".d-header").removeClass("hide-menus");
  }
});
</script>
